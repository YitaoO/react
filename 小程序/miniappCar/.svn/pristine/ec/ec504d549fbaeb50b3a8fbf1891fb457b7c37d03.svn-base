import Taro, { Component } from "@tarojs/taro";
import { connect } from "@tarojs/redux";
import { View } from "@tarojs/components";
import ScorllHistory from "../../components/scrollView/historyView";
import Dialog from "../../components/dialog";

import "./index.scss";

@connect(({ userInfo, car, map }) => ({
  userInfo,
  car,
  map
}))
export default class HistoryIndex extends Component {
  config = {
    navigationBarTitleText: "历史轨迹"
  };
  constructor(props) {
    super(props);

    this.state = {};
    this.handleCarChoice = this.handleCarChoice.bind(this);
  }
  componentDidShow() {
    //返回按钮会执行这个方法
    this.props.dispatch({
      type: "map/saveState",
      response: {
        type: 0
      }
    });
  }
  componentDidMount() {
    this.props.dispatch({
      type: "car/getCarTree",
      payload: {
        UserId: this.props.userInfo.carUserInfo.UserID
      }
    });
  }
  //开启下拉
  onPullDownRefresh = () => {
    console.log("我下拉了");
  };
  handleCarChoice = () => {
    Taro.navigateTo({ url: "/pages/choiceCar/index" });
  };

  render() {
    const { choiceCar } = this.props.car;
    const { list } = this.props.car.carGuijiList;
    return (
      <View className="history-index-wrap">
        <View className="index-top">
          <View className="top-wrap">
            <View className="left">
              <View className="title">{choiceCar.carName}</View>
              <View className="value">{choiceCar.carNumber}</View>
            </View>

            <View className="right" onClick={this.handleCarChoice}>
              选择车辆
            </View>
          </View>
        </View>

        <View className="index-center">
          {list.length > 0 && <View className="title">历史轨迹</View>}

          <View className="lists">
            <ScorllHistory />
          </View>
        </View>
      </View>
    );
  }
}
