import Taro, { Component } from "@tarojs/taro";
import { View, Button } from "@tarojs/components";
import { connect } from "@tarojs/redux";
//组件 - baiduMap
import BaiduMap from "../../components/baiduMap/main";
import wxTools from "../../components/tools/wx_tools";
// 功能 -websocket
import webSocket from "../../components/webSocket";

import "./index.scss";
@connect(({ userInfo }) => ({
  userInfo
}))
export default class Index extends Component {
  componentDidMount = () => {
    let that = this;
    const { carUserInfo } = this.props.userInfo;

    if (carUserInfo == "") {
      wxTools.getOpenId().then(function(res) {
        that.props.dispatch({
          type: "userInfo/saveOpenId",
          openId: res.openid
        });
        that.props.dispatch({
          type: "userInfo/login",
          payload: {
            openID: res.openid,
            weixin: "weixin"
          }
        });
      });
    }
    Taro.showLoading({
      title: "加载中..."
    });
  };

  render() {
    return (
      <View className={["index-wrap"]}>
        <View className="map-wrap">
          <BaiduMap />
        </View>
      </View>
    );
  }
}
