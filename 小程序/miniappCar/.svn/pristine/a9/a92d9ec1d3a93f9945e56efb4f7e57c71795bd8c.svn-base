import "@tarojs/async-await";
import Taro, { Component } from "@tarojs/taro";
import Index from "./pages/index";
import dva from "./dva";
import models from "./model";
import { Provider } from "@tarojs/redux";
import wxTools from "./components/tools/wx_tools";
import "./app.scss";

const dvaApp = dva.createApp({
  initialState: {},
  models: models,
  onError(e, dispatch) {
    dispatch({
      type: "sys/error",
      e
    });
  }
});

const store = dvaApp.getStore();

class App extends Component {
  constructor(props) {
    super(props);
  }
  config = {
    pages: [
      "pages/index/index", //首页
      "pages/registration/index", //注册页
      "pages/history/index" //历史轨迹-主页
    ],
    window: {
      backgroundTextStyle: "light",
      navigationBarBackgroundColor: "#58bdf2",
      // navigationBarTitleText: "标题",
      navigationBarTextStyle: "white",
      enablePullDownRefresh: true
    }
  };
  componentWillMount() {}

  componentDidMount() {
    // 获取openId
    wxTools.addCloud();

    wxTools.getOpenId().then(function(res) {
      dvaApp.dispatch({
        type: "userInfo/saveOpenId",
        openId: res.openid
      });
    });
  }

  componentDidShow() {}

  componentDidHide() {}

  componentCatchError() {}

  render() {
    return <Provider store={store}>{<Index />}</Provider>;
  }
}

Taro.render(<App />, document.getElementById("app"));
