import Taro, { Component } from "@tarojs/taro";
import { connect } from "@tarojs/redux";
import { View } from "@tarojs/components";
import Dialog from "../../components/dialog";
import ScorllHistory from "../../components/scrollView/historyView";
import Arrow from "../../images/navigator_arrow_icon.png";

import "./index.scss";

@connect(({ userInfo, car, carTree, map }) => ({
  userInfo,
  car,
  carTree,
  map
}))
export default class HistoryIndex extends Component {
  config = {
    navigationBarTitleText: "历史轨迹"
  };
  constructor(props) {
    super(props);
    this.state = {};
    this.handleCarChoice = this.handleCarChoice.bind(this);
  }
  componentDidShow() {
    //返回按钮会执行这个方法
    this.props.dispatch({
      type: "map/saveState",
      response: {
        type: 0
      }
    });
  }
  componentDidShow() {
    const { carGuijiList } = this.props.car;
    const { choiceCar } = this.props.carTree;

    if (!!this.$router.params.isChoice) {
      Dialog.showLoading();
      this.props.dispatch({
        type: "car/getCarList",
        payload: {
          simno: choiceCar.gpsDeviceSimNo,
          page: carGuijiList.page,
          limit: carGuijiList.limit
        }
      });
    }
  }
  //开启下拉
  onPullDownRefresh = () => {
    console.log("我下拉了");
  };
  handleCarChoice = () => {
    Taro.navigateTo({ url: "/pages/choiceCar/index" });
  };

  render() {
    const { choiceCar } = this.props.carTree;
    console.log(choiceCar);

    return (
      <View className="history-index-wrap">
        <View className="index-top">
          {!!choiceCar && (
            <View className="top-wrap">
              <View className="left">
                <View className="title">{choiceCar.carName}</View>
                <View className="value">{choiceCar.carNumber}</View>
              </View>

              <View className="right" onClick={this.handleCarChoice}>
                选择车辆
              </View>
            </View>
          )}
          {!choiceCar && (
            <View className="top-wrap" onClick={this.handleCarChoice}>
              <View className="left">
                <View className="title">请选择车辆</View>
              </View>
              <View className="arrow-wrap">
                <Image className="image" src={Arrow} />
              </View>
            </View>
          )}
        </View>

        <View className="index-center">
          {list.length > 0 && <View className="title">历史轨迹</View>}

          <View className="lists">
            <ScorllHistory />
          </View>
        </View>
      </View>
    );
  }
}
