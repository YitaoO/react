import Taro, { Component } from "@tarojs/taro";
import { connect } from "@tarojs/redux";
import { View, Text, Image, Input, Button } from "@tarojs/components";

import "./index.scss";
import { runInThisContext } from "vm";

@connect(({ userInfo }) => ({
  openId: userInfo.openId
}))
class Registration extends Component {
  config = {
    navigationBarTitleText: "注册"
  };
  constructor(props) {
    super(props);
    this.state = {
      userName: "",
      idNo: ""
    };
    this.handleRes = this.handleRes.bind(this);
    this.inputPhoneChange = this.inputPhoneChange.bind(this);
    this.inputPassChange = this.inputPassChange.bind(this);
  }
  // 输入框变化
  inputPhoneChange = e => {
    this.setState({
      userName: e.detail.value
    });
  };
  inputPassChange = e => {
    this.setState({
      idNo: e.detail.value
    });
  };
  //注册
  // handleRes = () => {
  //   let userName = this.state.userName;
  //   let idNo = this.state.idNo;
  //   // if (this.state.userName == "" || this.state.idNo == "") return;

  //   this.props.dispatch({
  //     type: "userInfo/weixinAdd",
  //     payload: {
  //       userName: userName,
  //       idNo: idNo,
  //       openId: this.props.openId
  //     }
  //   });
  //   // Taro.redirectTo({ url: "/pages/index/index" });
  // };
  handleRes = e => {
    let weixinUserInfo = e.detail.userInfo;
    let userName = this.state.userName;
    let idNo = this.state.idNo;
    if (this.state.userName == "" || this.state.idNo == "") return;

    this.props.dispatch({
      type: "userInfo/saveUserInfo",
      weixinUserInfo
    });
    this.props.dispatch({
      type: "userInfo/weixinAdd",
      payload: {
        userName: userName,
        idNo: idNo,
        openId: this.props.openId,
        nickname: userInfo.nickName
      }
    });
  };

  render() {
    return (
      <View className="res-wrap">
        <Input />
        <View className="wrap-center">
          <View className="item grid-list">
            <View className="icon-wrap grid-list-item">
              <View className="icon phone" />
            </View>
            <View className="grid-list-item input-wrap">
              <Input
                className="input"
                placeholder-style="color:#999"
                placeholder="请输入用户名"
                onInput={this.inputPhoneChange}
                value={this.state.userName}
              />
            </View>
          </View>
          <View className="item grid-list">
            <View className="icon-wrap grid-list-item">
              <View className="icon id" />
            </View>
            <View className="grid-list-item input-wrap">
              <Input
                className="input"
                placeholder-style="color:#999"
                placeholder="请输入身份证"
                onInput={this.inputPassChange}
                value={this.state.idNo}
              />
            </View>
          </View>
        </View>
        <View className="btn-wrap">
          <Button
            type="primary"
            size="default"
            open-type="getUserInfo"
            lang="zh_CN"
            onGetuserinfo={this.handleRes}
          >
            注册
          </Button>
        </View>
      </View>
    );
  }
}

export default Registration;
