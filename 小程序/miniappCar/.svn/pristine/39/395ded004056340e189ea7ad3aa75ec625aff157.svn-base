import Taro from "@tarojs/taro";
import { reqCarStateList, reqListTreeCar } from "../services/api";
import carOn from "../images/index_car_on_icon.png";
import carOff from "../images/index_car_off_icon.png";

export default {
  namespace: "car",
  state: {
    carStateList: [], //车辆最新状态
    listTreeCar: [] //车辆树
  },
  reducers: {
    saveCarState(state, payload) {
      console.log(payload);
      return {
        ...state,
        ...payload.response
      };
    }
  },
  effects: {
    // 车辆最新状态
    *getCarLastState({ payload }, { call, put }) {
      let response = yield call(reqCarStateList, payload);
      Taro.hideLoading();
      response.forEach(item => {
        item.id = item.simno;
        item.width = 61;
        item.height = 61;
        item.iconPath = !!item.acc ? carOn : carOff;
        // item.callout = {
        //   display: "none",
        //   content: `<view>${item.carModel}\n${item.carModel}</view>`,
        //   bgColor: "#ffffff",
        //   padding: 15
        // };
      });

      yield put({
        type: "saveCarState",
        response: {
          carStateList: response
        }
      });
    },
    // 获取车辆树
    *getCarTree({ payload }, { call, put }) {
      let response = yield call(reqListTreeCar, payload);
      Taro.hideLoading();
      yield put({
        type: "saveCarState",
        response: {
          listTreeCar: response
        }
      });
    }
  }
};
